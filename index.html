<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ReChat Universal App</title>
    <style>
        :root {
            --gradient: linear-gradient(45deg, #f09433, #e95950, #bc1888);
            --bg-dark: #121213;
            --bubble-left: #262626;
        }

        body {
            background-color: #000;
            color: white;
            font-family: 'Segoe UI', sans-serif;
            margin: 0;
            display: flex;
            flex-direction: column;
            height: 100vh;
            overflow: hidden;
        }

        /* Cabecera con el título de la imagen */
        .app-header {
            padding: 30px 10px;
            text-align: center;
        }

        .app-header h1 {
            margin: 0;
            font-size: 45px;
            font-style: italic;
            background: var(--gradient);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            font-weight: 900;
        }

        /* Contenedor de Chat */
        #chat-container {
            flex: 1;
            overflow-y: auto;
            padding: 20px;
            display: flex;
            flex-direction: column;
            gap: 15px;
            background-color: var(--bg-dark);
            border-top: 1px solid #333;
        }

        /* Burbujas de Diseño */
        .message {
            max-width: 75%;
            padding: 12px 20px;
            font-size: 15px;
            line-height: 1.4;
            position: relative;
            box-shadow: 0 4px 10px rgba(0,0,0,0.3);
        }

        /* Lado Izquierdo (Primer Usuario detectado) */
        .left {
            align-self: flex-start;
            background: var(--bubble-left);
            border-radius: 20px 20px 20px 5px;
            border: 1px solid #444;
        }

        /* Lado Derecho (Segundo Usuario) */
        .right {
            align-self: flex-end;
            background: var(--gradient);
            border-radius: 20px 20px 5px 20px;
        }

        .user-name {
            font-size: 11px;
            font-weight: bold;
            margin-bottom: 5px;
            opacity: 0.6;
            display: block;
        }

        /* Botón Flotante / Inferior */
        .footer {
            padding: 25px;
            background: var(--bg-dark);
            text-align: center;
            border-top: 1px solid #333;
        }

        .btn-upload {
            background: var(--gradient);
            border: none;
            padding: 15px 50px;
            border-radius: 35px;
            color: white;
            font-weight: bold;
            font-size: 18px;
            cursor: pointer;
            text-transform: uppercase;
            box-shadow: 0 5px 20px rgba(188, 24, 136, 0.5);
        }

        #status-text { color: #666; font-size: 12px; margin-top: 10px; }
    </style>
</head>
<body>

    <div class="app-header">
        <h1>ReChat AI</h1>
    </div>

    <div id="chat-container">
        <p style="text-align: center; color: #444; margin-top: 50px;">
            Listo para recibir archivo...
        </p>
    </div>

    <div class="footer">
        <input type="file" id="fileIn" style="display:none">
        <button class="btn-upload" onclick="document.getElementById('fileIn').click()">CARGAR CHAT</button>
        <div id="status-text">Compatible con cualquier archivo JSON</div>
    </div>

<script>
    document.getElementById('fileIn').onchange = function(e) {
        const reader = new FileReader();
        const container = document.getElementById('chat-container');
        const status = document.getElementById('status-text');
        
        status.innerText = "Procesando archivo pesado...";
        
        reader.onload = function(ev) {
            try {
                const data = JSON.parse(ev.target.result);
                // Busca los mensajes sin importar el nombre de la carpeta
                const msgs = data.messages || (Array.isArray(data) ? data : []);
                
                if (msgs.length === 0) throw "No se encontraron mensajes";

                container.innerHTML = "";
                
                // Detecta automáticamente quién es el primer usuario para ponerlo a la izquierda
                const primerUsuario = msgs[0].sender_name;

                // Solo carga los últimos 200 para que la App no se cuelgue
                msgs.slice(-200).forEach(m => {
                    const esLadoA = (m.sender_name === primerUsuario);
                    const div = document.createElement('div');
                    div.className = message ${esLadoA ? 'left' : 'right'};
                    div.innerHTML = `
                        <span class="user-name">${m.sender_name}</span>
                        <div>${m.content || "[Multimedia]"}</div>
                    `;
                    container.appendChild(div);
                });
                
                container.scrollTop = container.scrollHeight;
                status.innerText = "Chat cargado con éxito.";
                
            } catch(err) {
                status.innerText = "Error: El archivo no es un JSON válido.";
                container.innerHTML = <pre style="color:#0f0; padding:20px;">${ev.target.result.substring(0, 5000)}</pre>;
            }
        };
        reader
