<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>ReChat Universal App</title>
    <style>
        body { background: #0a0a0a; color: #fff; font-family: sans-serif; margin: 0; display: flex; flex-direction: column; height: 100vh; }
        .nav { background: #121212; padding: 15px; text-align: center; border-bottom: 2px solid #bc1888; color: #bc1888; font-weight: bold; }
        #chat-box { flex: 1; overflow-y: auto; padding: 15px; display: flex; flex-direction: column; gap: 10px; }
        .msg { max-width: 85%; padding: 12px; border-radius: 15px; font-size: 14px; line-height: 1.4; color: white; }
        /* Colores autom√°ticos por lado */
        .lado-a { background: #262626; align-self: flex-start; border-bottom-left-radius: 2px; }
        .lado-b { background: linear-gradient(45deg, #e95950, #bc1888); align-self: flex-end; border-bottom-right-radius: 2px; }
        .author { font-size: 10px; font-weight: bold; margin-bottom: 4px; opacity: 0.7; display: block; }
        .footer { padding: 20px; background: #121212; text-align: center; border-top: 1px solid #222; }
        .btn { background: #bc1888; color: white; border: none; padding: 15px 30px; border-radius: 30px; cursor: pointer; font-weight: bold; box-shadow: 0 4px 15px rgba(188,24,136,0.3); }
    </style>
</head>
<body>
    <div class="nav">RECHAT UNIVERSAL</div>
    <div id="chat-box"><p style="text-align:center;color:#444;margin-top:20vh;">Sube cualquier archivo JSON de chat</p></div>
    <div class="footer">
        <input type="file" id="input-file" style="display:none">
        <button class="btn" onclick="document.getElementById('input-file').click()">CARGAR MI ARCHIVO</button>
    </div>

<script>
    document.getElementById('input-file').onchange = function(e) {
        const reader = new FileReader();
        const box = document.getElementById('chat-box');
        
        box.innerHTML = "<h2 style='text-align:center'>PROCESANDO...</h2>";

        reader.onload = function(ev) {
            try {
                const data = JSON.parse(ev.target.result);
                const msgs = data.messages || (Array.isArray(data) ? data : []);
                
                if (msgs.length === 0) throw "No hay mensajes";

                // Identificamos al primer usuario que aparece para fijarlo a la izquierda
                const primerUsuario = msgs[0].sender_name;
                let html = "";

                // Cargamos un bloque seguro de 300 mensajes
                msgs.slice(-300).forEach(m => {
                    const esLadoA = (m.sender_name === primerUsuario);
                    html += `
                        <div class="msg ${esLadoA ? 'lado-a' : 'lado-b'}">
                            <span class="author">${m.sender_name}</span>
                            ${m.content || "[Multimedia/No Texto]"}
                        </div>`;
                });

                box.innerHTML = html;
                box.scrollTop = box.scrollHeight;
            } catch(err) {
                box.innerHTML = "<div style='color:red;padding:20px;'>Error: El archivo no tiene el formato correcto de chat.</div>";
            }
        };
        reader.readAsText(e.target.files[0]);
    };
</script>
</body>
</html>
