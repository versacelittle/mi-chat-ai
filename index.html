<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>ReChat Pro | Analyzer</title>
    <style>
        :root { --accent: #bc1888; --bg-chat: #ffffff; }
        body { background: #f0f2f5; color: #1c1e21; font-family: sans-serif; margin: 0; display: flex; flex-direction: column; height: 100vh; }
        
        /* Cabecera y Herramientas */
        .header { background: #fff; padding: 10px 20px; border-bottom: 1px solid #ddd; display: flex; justify-content: space-between; align-items: center; }
        .header h1 { margin: 0; font-size: 20px; background: linear-gradient(45deg, #f09433, #bc1888); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        
        .toolbar { background: #f8f9fa; padding: 10px; display: flex; gap: 10px; overflow-x: auto; border-bottom: 1px solid #ddd; }
        .tool-btn { background: #fff; border: 1px solid #ddd; padding: 5px 12px; border-radius: 15px; font-size: 12px; cursor: pointer; white-space: nowrap; }
        .tool-btn:hover { background: #eee; }

        /* √Årea de Chat */
        #chat-box { flex: 1; overflow-y: auto; padding: 20px; display: flex; flex-direction: column; gap: 10px; background: var(--bg-chat); transition: 0.3s; }
        .bubble { max-width: 75%; padding: 10px; border-radius: 15px; font-size: 14px; position: relative; box-shadow: 0 1px 2px rgba(0,0,0,0.1); }
        .left { background: #e4e6eb; align-self: flex-start; }
        .right { background: #bc1888; color: white; align-self: flex-end; }
        .user { font-size: 9px; font-weight: bold; opacity: 0.7; display: block; }

        /* Footer */
        .footer { padding: 15px; background: #fff; border-top: 1px solid #ddd; text-align: center; }
        .btn-main { background: #bc1888; color: white; border: none; padding: 10px 30px; border-radius: 20px; font-weight: bold; cursor: pointer; }
    </style>
</head>
<body>

<div class="header">
    <h1>ReChat Pro</h1>
    <div id="stats-summary" style="font-size: 11px; color: #666;">Carga un chat para ver stats</div>
</div>

<div class="toolbar" id="tools" style="display:none">
    <button class="tool-btn" onclick="analizarIA()">‚ú® Analizar con IA</button>
    <button class="tool-btn" onclick="cambiarFondo()">üé® Cambiar Fondo</button>
    <button class="tool-btn" onclick="descargarChat()">üíæ Descargar Resumen</button>
    <button class="tool-btn" onclick="verStats()">üìä Estad√≠sticas Detalladas</button>
</div>

<div id="chat-box">
    <p style="text-align:center; color:#999; margin-top:100px;">Sube tu JSON para activar las funciones pro.</p>
</div>

<div class="footer">
    <input type="file" id="f" style="display:none">
    <button class="btn-main" onclick="document.getElementById('f').click()">CARGAR CHAT</button>
</div>

<script>
    let mensajesCargados = [];

    document.getElementById('f').onchange = function(e) {
        const reader = new FileReader();
        reader.onload = function(ev) {
            try {
                const data = JSON.parse(ev.target.result);
                mensajesCargados = data.messages || (Array.isArray(data) ? data : []);
                document.getElementById('tools').style.display = 'flex';
                renderChat();
                actualizarStatsRapidas();
            } catch(err) { alert("Error al leer JSON"); }
        };
        reader.readAsText(e.target.files[0]);
    };

    function renderChat() {
        const box = document.getElementById('chat-box');
        const primerNombre = mensajesCargados[0].sender_name;
        box.innerHTML = mensajesCargados.slice(-300).map(m => `
            <div class="bubble ${m.sender_name === primerNombre ? 'left' : 'right'}">
                <span class="user">${m.sender_name}</span>
                ${m.content || "[Multimedia]"}
            </div>
        `).join('');
        box.scrollTop = box.scrollHeight;
    }

    function actualizarStatsRapidas() {
        document.getElementById('stats-summary').innerText = Total: ${mensajesCargados.length} mensajes analizados;
    }

    function cambiarFondo() {
        const color = prompt("Escribe un color (ej: #ffebee, lightblue, white, #e3f2fd):", "#ffffff");
        if(color) document.documentElement.style.setProperty('--bg-chat', color);
    }

    function verStats() {
        const conteo = {};
        mensajesCargados.forEach(m => conteo[m.sender_name] = (conteo[m.sender_name] || 0) + 1);
        let msg = "üìä ESTAD√çSTICAS:\n";
        for(let user in conteo) msg += ${user}: ${conteo[user]} mensajes\n;
        alert(msg);
    }

    function descargarChat() {
        const texto = mensajesCargados.slice(-100).map(m => ${m.sender_name}: ${m.content}).join('\n');
        const blob = new Blob([texto], {type: 'text/plain'});
        const a = document.createElement('a');
        a.href = URL.createObjectURL(blob);
        a.download = 'resumen_rechat.txt';
        a.click();
    }

    function analizarIA() {
        const total = mensajesCargados.length;
        const ultimoMsg = mensajesCargados[mensajesCargados.length-1].content;
        alert("ü§ñ IA ANALIZANDO...\n\nHe analizado " + total + " mensajes. El sentimiento parece positivo. El √∫ltimo tema fue: '" + ultimoMsg + "'. \n\nConsejo: Mant√©n la conversaci√≥n fluida.");
    }
</script>
</body>
</html>

