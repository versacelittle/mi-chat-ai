<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>ReChat AI | Final</title>
    <style>
        body { background: #0e0e0e; color: #fff; font-family: sans-serif; margin: 0; padding: 20px; text-align: center; }
        .btn-rosa { background: linear-gradient(45deg, #f09433, #e95950, #bc1888); color: white; border: none; padding: 15px 30px; border-radius: 25px; cursor: pointer; font-weight: bold; width: 100%; max-width: 400px; margin-bottom: 20px; }
        #chat-area { display: none; text-align: left; max-width: 600px; margin: 0 auto; background: #1a1a1a; padding: 15px; border-radius: 15px; border: 1px solid #333; }
        .msg { border-bottom: 1px solid #333; padding: 10px; margin-bottom: 5px; }
        .user { color: #bc1888; font-weight: bold; }
    </style>
</head>
<body>
    <h1 style="background: linear-gradient(45deg, #f09433, #bc1888); -webkit-background-clip: text; -webkit-text-fill-color: transparent;">ReChat AI</h1>
    <input type="file" id="archivo" style="display:none">
    <button class="btn-rosa" onclick="document.getElementById('archivo').click()">SELECCIONAR CHAT</button>
    <div id="chat-area"></div>

<script>
    document.getElementById('archivo').onchange = function(e) {
        const reader = new FileReader();
        const area = document.getElementById('chat-area');
        
        reader.onload = function(ev) {
            try {
                // Forzamos la lectura incluso si el JSON tiene errores leves
                const raw = ev.target.result;
                const data = JSON.parse(raw);
                const msgs = data.messages || data;
                
                area.style.display = 'block';
                area.innerHTML = "<h3>Cargados " + msgs.length + " mensajes</h3>";
                
                msgs.slice(-200).forEach(m => {
                    area.innerHTML += <div class="msg"><span class="user">${m.sender_name}:</span><br>${m.content || "[Multimedia]"}</div>;
                });
            } catch(err) {
                // Si falla el diseño, mostramos el texto puro como antes para no perder nada
                area.style.display = 'block';
                area.innerHTML = "<h3>Error de diseño, mostrando texto puro:</h3><pre style='color:#0f0; white-space:pre-wrap;'>" + ev.target.result.substring(0, 5000) + "</pre>";
            }
        };
        reader.readAsText(e.target.files[0]);
    };
</script>
</body>
</html>
